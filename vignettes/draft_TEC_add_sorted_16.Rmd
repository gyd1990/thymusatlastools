---
title: "Figure drafts for Jan 2017 submission"
author: "Eric Kernfeld"
date: "January 18, 2017"
output: html_document
---

```{r}
results_path = Sys.getenv( "FREEZR_DESTINATION" )

# # Retrieve clean overview TECs plus sorted data
dge_whole = inventory( tag = "mTEC_cTEC_clean_labeled" ) %>% readRDS 
cu = FetchData(dge_whole, c( "cell_type", "eday" ) ) %>% 
  subset( cell_type %in% c( "mTEC", "cTEC" ) ) %>% rownames
dge_whole = SubsetData(dge_whole, cells.use = cu )

# Get sorted data & explore
dge = c( "time_sorted_16" ) %>% 
  get_sample_groups( combine = T ) %>% 
  load_thymus_profiling_data %>% 
  c( list( whole_TECs = deseuratify_raw_data( dge_whole ) ) ) %>% 
  dge_merge_list %>% 
  seuratify_thy_data( results_path )

batches =  c("e12_5wholeThy_venus" , 
             "e12_5wholeThy_venus_rep2" , 
             "e12_5wholeThy_venus_rep3" , 
             "e13_5_wholeThymus_wt_rep4" , 
             "e13_5_wholeThymus_wt_rep5" , 
             "e13_5wholeThy_wt_rep3" , 
             "E14_5_WholeThy_rep2" , 
             "E14_5_WholeThy_rep4" , 
             "E15_5_WholeThy_Rep1" , 
             "E15_5_WholeThy_Rep2" , 
             "E16_5_WholeThy_Rep2_combine" , 
             "E16_5_WholeThy_Rep3_combine" , 
             "e16_5_wholeThymus_wt_rep1" , 
             "e16_5EpCAM_rep1" , 
             "e16_5EpCAM_rep2" )
atae( dge@data.info$orig.ident %>% unique %>% sort %>% as.character, batches)
dge %<>% add_maehrlab_metadata( "eday" )

# # Fill in tSNE and PCA et cetera
all_params = expand.grid( cc_method = c( "average" ),
                          excess_var_cutoff = c( 0.5 ),
                          log_expr_cutoff = c( 0.1 ), 
                          prop_genes_to_select = NA, 
                          num_genes_to_select = NA, 
                          var_gene_method = "seurat",
                          num_pc =  8, 
                          clust_method = "SNN",
                          clust_granularities_as_string = "0.5",
                          plot_all_var_genes = F,
                          stringsAsFactors = F)
dge = explore_embeddings( dge, results_path = results_path, all_params)
```
