---
title: "Figure drafts for Jan 2017 submission"
author: "Eric Kernfeld"
date: "January 18, 2017"
output: html_document
---

```{r}
results_path = Sys.getenv( "FREEZR_DESTINATION" )

# # Retrieve clean overview TECs plus sorted data
dge_overview = inventory( tag = "overview_clean_labeled" ) %>% readRDS
dge_overview_TECs_raw = dge_overview %>% SubsetData(ident.use = paste0( "TEC", 1:3 ) ) %>% deseuratify_raw_data
rm( dge_overview ); gc()

il7_pos = function(X) X[, X["Il7",]>0 ]
  
dge = c( "time_sorted_10", "time_sorted_11" ) %>% 
  get_sample_groups( combine = T ) %>% 
  load_thymus_profiling_data %>% 
  lapply( il7_pos ) %>%
  c( list( overview_tecs = dge_overview_TECs_raw ) ) %>%
  dge_merge_list %>% 
  seuratify_thy_data( results_path )
rm(dge_overview_TECs_raw); gc()

dge = add_maehrlab_metadata( dge, "eday" )

# # Fill in tSNE and PCA et cetera
all_params = expand.grid( cc_method = c( "average" ),
                          excess_var_cutoff = c( 0.5, 0.8, 1.2 ),
                          log_expr_cutoff = c( 0.1 ), 
                          prop_genes_to_select = NA, 
                          num_genes_to_select = NA, 
                          var_gene_method = "seurat",
                          num_pc = c( 8, 12 ), 
                          clust_method = "SNN",
                          clust_granularities_as_string = "0.5",
                          plot_all_var_genes = F,
                          stringsAsFactors = F)
dge = explore_embeddings( dge, results_path = results_path, all_params)

```
